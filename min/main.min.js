var historyEventArr=[],NUMBER_OF_ANSWER_CHOICES=4,StatsObj=function(){this.totalAttempted=0,this.totalPoints=0};StatsObj.prototype.averagePerformance=function(){return this.totalPoints/this.totalAttempted};var userStats=new StatsObj,pickIndexToCreateQuestion=function(){var t;do t=_.random(historyEventArr.length-1);while(historyEventArr[t].attemptedQuestion);historyEventArr[t].attemptedQuestion=!0,userStats.totalAttempted++,$("#questions-answered").text("Q: "+userStats.totalAttempted+"/"+historyEventArr.length);var e=$("<div>").addClass("col-sm-12 history-event").text(historyEventArr[t].eventStr).attr("data-eventyear",historyEventArr[t].year).attr("data-eventindex",t);return $("#events-row").append(e),getStartingIndexAndRange(t)},today=new Date,strDateQuery=function(t){var e=["January","February","March","April","May","June","July","August","September","October","November","December"],r=t.getMonth();return $("#todays-date").text(e[r]+" "+t.getDate()),createWikiEventsScript(e[r]+"%20"+t.getDate())},HistoryEvent=function(t,e){this.eventStr=t,this.year=e,this.score=4,this.attemptedQuestion=!1},getSameYearCount=function(t){for(var e=0,r=t+1;t+NUMBER_OF_ANSWER_CHOICES>r;r++)historyEventArr[r].year===historyEventArr[r-1].year&&e++;return e},getStartingIndexAndRange=function(t){var e=t-_.random(NUMBER_OF_ANSWER_CHOICES-1);0>e&&(e=0),e>historyEventArr.length-NUMBER_OF_ANSWER_CHOICES&&(e=historyEventArr.length-NUMBER_OF_ANSWER_CHOICES);for(var r=getSameYearCount(e);e+NUMBER_OF_ANSWER_CHOICES-1+r>=historyEventArr.length;)e--;return createGuessYearArr(e)},createGuessYearArr=function(t){for(var e=[],r=t;r<historyEventArr.length&&e.length!==NUMBER_OF_ANSWER_CHOICES;r++)(r==t||historyEventArr[r].year!=historyEventArr[r-1].year)&&e.push(historyEventArr[r].year);return renderGuessYearArr(e)},renderGuessYearArr=function(t){for(var e=0;e<t.length;e++){var r=$("<div>").addClass("col-sm-12 year-choice").attr("id","choice"+e).text(t[e]);$("#dates-row").append(r)}},createWikiEventsScript=function(t){return createScriptEl("http://en.wikipedia.org/w/api.php?action=query&prop=revisions&rvprop=content&rvparse=&rvlimit=1&rvsection=1&indexpageids=&titles="+t+"&format=json&callback=getTodaysEvents")},createScriptEl=function(t){return $("<script>").attr("src",t)},getTodaysEvents=function(t){var e=t.query.pageids[0],r=t.query.pages[e].revisions[0]["*"],n=$('<div class="todays-events-container">').html(r);$(".container").after(n),$(n).hide();var o=$(".todays-events-container > ul li");return parseEventsHTMLIntoObjects(o)},testIfCharIsNum=function(t,e){return t.charCodeAt(e)>47&&t.charCodeAt(e)<58},parseYearFromScrapedEventString=function(t){for(var e="",r=0;r<t.length;r++)if(testIfCharIsNum(t,r)&&(e+=t.charAt(r),!testIfCharIsNum(t,r+1))){if("B"==t.charAt(r+2)&&"C"==t.charAt(r+3)){e+=" BC";break}break}return e},parseEventsHTMLIntoObjects=function(t){for(var e=0;e<t.length;e++){var r=t.eq(e).text(),n=parseYearFromScrapedEventString(r),o=r.slice(n.length+3),s=new HistoryEvent(o,n);historyEventArr.push(s)}},clickedAnswer=function(){return $(this).text()===$(".history-event").attr("data-eventyear")?clickedCorrectAnswer(this):$(this).text()!==$(".history-event").attr("data-eventyear")?clickedWrongAnswer(this):void 0},clickedCorrectAnswer=function(t){$("#dates-row").off("click",".year-choice",clickedAnswer),console.log("correct!"),$(t).css("background-color","rgb(39, 174, 96)"),console.log(historyEventArr[$(".history-event").attr("data-eventindex")].score),userStats.totalPoints+=historyEventArr[$(".history-event").attr("data-eventindex")].score,$("#point-total").text("Score: "+userStats.totalPoints),$("#average-score").text("Avg: "+userStats.averagePerformance()),userStats.totalAttempted===historyEventArr.length?$("#events-row").append('<button type="button" class="btn btn-warning btn-block" id="game-over-stats">Game Over! Click to see how you did!</button>'):($("#events-row").append('<button type="button" class="btn btn-primary" id="next-question">Next Question!</button>'),$("#next-question").on("click",function(){$("#dates-row").empty(),$("#events-row").empty(),pickIndexToCreateQuestion(),$("#dates-row").on("click",".year-choice",clickedAnswer)}))},clickedWrongAnswer=function(t){console.log("Wrong"),$(t).css("background-color","rgb(231, 76, 60)"),$(t).click(!1),4===historyEventArr[$(".history-event").attr("data-eventindex")].score?historyEventArr[$(".history-event").attr("data-eventindex")].score=2:2===historyEventArr[$(".history-event").attr("data-eventindex")].score?historyEventArr[$(".history-event").attr("data-eventindex")].score=1:1===historyEventArr[$(".history-event").attr("data-eventindex")].score&&(historyEventArr[$(".history-event").attr("data-eventindex")].score=0,$("#dates-row").off("click",".year-choice",clickedAnswer),userStats.totalAttempted===historyEventArr.length?$("#events-row").append('<button type="button" class="btn btn-warning btn-block" id="game-over-stats">Game Over! Click to see how you did!</button>'):($("#events-row").append('<button type="button" class="btn btn-primary" id="next-question">Next Question!</button>'),$("#next-question").on("click",function(){$("#dates-row").empty(),$("#events-row").empty(),pickIndexToCreateQuestion(),$("#dates-row").on("click",".year-choice",clickedAnswer)}))),console.log(historyEventArr[$(".history-event").attr("data-eventindex")].score)};$(document).on("ready",function(){$("body").append(strDateQuery(today)),setTimeout(pickIndexToCreateQuestion,3e3),$("#dates-row").on("click",".year-choice",clickedAnswer),$("#button-summary").on("click",function(){$(this).hide(),$("#button-hide-summary").show();for(var t=0;t<historyEventArr.length;t++)if(historyEventArr[t].attemptedQuestion){var e=$('<div class="row">');e.append("<div class='col-xs-2 points-summary'>"+historyEventArr[t].score+" pts</div>"),e.append("<div class='col-xs-2 year-summary'>"+historyEventArr[t].year+"</div>"),e.append("<div class='col-xs-8'>"+historyEventArr[t].eventStr+"</div>"),$("#stats-summary").append(e)}}),$("#button-hide-summary").on("click",function(){$(this).hide(),$("#button-summary").show(),$("#stats-summary").empty()})});