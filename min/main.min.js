var historyEventArr=[],NUMBER_OF_ANSWER_CHOICES=4,pickIndexToCreateQuestion=function(){var t;do t=_.random(historyEventArr.length);while(historyEventArr[t].attemptedQuestion);return historyEventArr[t].attemptedQuestion=!0,t},today=new Date;Date.prototype.strDateQuery=function(){var t=["January","February","March","April","May","June","July","August","September","October","November","December"],r=today.getMonth();return createWikiEventsScript(t[r]+"%20"+today.getDate())};var HistoryEvent=function(t,r){this.eventStr=t,this.year=r,this.score=4,this.attemptedQuestion=!1};HistoryEvent.prototype.pushToArr=function(){historyEventArr.push(this)},HistoryEvent.prototype.guessYear=function(t){var r=_.random(-NUMBER_OF_ANSWER_CHOICES,NUMBER_OF_ANSWER_CHOICES)+t,e=0;0>r&&(r=0),r>historyEventArr.length-NUMBER_OF_ANSWER_CHOICES&&(r=historyEventArr.length-NUMBER_OF_ANSWER_CHOICES);for(var n=r;r+NUMBER_OF_ANSWER_CHOICES>n;n++)historyEventArr[n].year===historyEventArr[n+1].year&&e++;r+NUMBER_OF_ANSWER_CHOICES-1+e>=historyEventArr.length&&(r-=e)};var createWikiEventsScript=function(t){return createScriptEl("http://en.wikipedia.org/w/api.php?action=query&prop=revisions&rvprop=content&rvparse=&rvlimit=1&rvsection=1&indexpageids=&titles="+t+"&format=json&callback=getTodaysEvents")},createScriptEl=function(t){return $("<script>").attr("src",t)},getTodaysEvents=function(t){var r=t.query.pageids[0],e=t.query.pages[r].revisions[0]["*"],n=$('<div class="todays-events-container">').html(e);$(".container").append(n),$(n).hide();var a=$(".todays-events-container > ul li");return parseEventsHTMLIntoObjects(a)},testIfCharIsNum=function(t,r){return t.charCodeAt(r)>47&&t.charCodeAt(r)<58},parseYearFromScrapedEventString=function(t){for(var r="",e=0;e<t.length;e++)if(testIfCharIsNum(t,e)&&(r+=t.charAt(e),!testIfCharIsNum(t,e+1))){if("B"==t.charAt(e+2)&&"C"==t.charAt(e+3)){r+=" BC";break}break}return r},parseEventsHTMLIntoObjects=function(t){for(var r=0;r<t.length;r++){var e=t.eq(r).text(),n=parseYearFromScrapedEventString(e),a=e.slice(n.length+3),o=new HistoryEvent(a,n);historyEventArr.push(o)}};$(document).on("ready",function(){$("body").append(today.strDateQuery())});